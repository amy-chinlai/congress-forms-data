<!DOCTYPE html>
<html>
	<head>
		<title>JSON Overwrite Tester</title>
		<style>
			body {
				font-family: "Helvetica";
				font-size: 14px;
				color: #2c2c2c;
			}
			
			.left, .right {
				width: 50%;
				float: left;
			}
			
			input, textarea, select {
				width: 80%;
				text-decoration: none;
			    font-size: 14px;
			    border-radius: 3px;
			    padding: 7px 10px;
			    border: 1px solid black;
			    min-height: 20px;
			    line-height: 20px;
			    box-sizing: border-box;
			    white-space: normal;
			    display: block;
			    margin: 0px 20px 40px 20px;
			}
			
			label {
				margin: 20px 20px 10px 20px;
				display: block;
				
			}
			
			input[type="submit"] {
			    color: #FFFFFF;
			    background-color: #717171;
			    font-weight: 700;
			    margin-top: 40px;
			}
			
			input[type="radio"] {
				display: inline;
				width: auto;
				margin-bottom: 10px;
			}
			
			textarea {
				height: 1000px;
			}
			
			select {
				margin-bottom: 10px;
			}
			
			.disabled {
				background-color: #d0d0d0 !important;
			}
		</style>
	</head>
	<body>
		
		<div class="left">
		
			<label>Overwrite JSON file:</label>
			<select id="overwrite_file_select">
				<option value="">[choose one]</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_legislatorUpperBody_overwrite.json">legislatorUpperBody</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_legislatorLowerBody_overwrite.json">legislatorLowerBody</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_congress_overwrite.json">congress</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_headOfGovernment_overwrite.json">headOfGovernment</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_statelevel_upper_overwrite.json">statelevel_upper</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_statelevel_lower_overwrite.json">statelevel_lower</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_statelevel_overwrite.json">statelevel</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/bioids.json">BioIDs</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdids_headOfGovernment.csv">headOfGovernment CSV</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdids_statelevel_lower.csv">ocdids_statelevel_lower CSV</option>
				<option value="https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdids_statelevel_upper.csv">ocdids_statelevel_upper CSV</option>
			</select>
			<input type="text" id="overwrite_file" value="" placeholder="...or enter a URL" />
			<label>Google Civic API key:</label>
			<input type="text" id="google_api_key" value="AIzaSyCJIHXel7hqyAMA6ekcM0S8z8oxG1lvpIY" />
			
			<label>Run which test?</label>
			<label>
				<input name="type" class="type" value="overwrite_name_match" type="radio">
				Name Match (Do overwrite names match Google Civic names?)
			</label>
			<label>
				<input name="type" class="type" value="overwrite_necessity" type="radio">
				Necessity (Do we need overwrites to add emails/phones or change names?)
			</label>
			
			<label>
				<input name="type" class="type" value="bioid_necessity" type="radio">
				BioID Necessity (Do we need bioid listing?)
			</label>
			
			<label>
				<input name="type" class="type" value="contact_method_present" type="radio">
				Contact Method Present [email] (Do we have a way to contact this person?)
			</label>
			
			<label>
				<input name="type" class="type" value="contact_method_present_phone" type="radio">
				Contact Method Present [phone] (Do we have a way to contact this person?)
			</label>
			
			<label>
				<input name="type" class="type" value="json_merge" type="radio">
				JSON merge
			</label>
			
			<label>Ignore which states?</label>
			<label>
				<select multiple="true" id="ignore_states">
					<option value="AL">Alabama</option>
					<option value="AK">Alaska</option>
					<option value="AZ">Arizona</option>
					<option value="AR">Arkansas</option>
					<option value="CA">California</option>
					<option value="CO">Colorado</option>
					<option value="CT">Connecticut</option>
					<option value="DE">Delaware</option>
					<option value="DC">District Of Columbia</option>
					<option value="FL">Florida</option>
					<option value="GA">Georgia</option>
					<option value="HI">Hawaii</option>
					<option value="ID">Idaho</option>
					<option value="IL">Illinois</option>
					<option value="IN">Indiana</option>
					<option value="IA">Iowa</option>
					<option value="KS">Kansas</option>
					<option value="KY">Kentucky</option>
					<option value="LA">Louisiana</option>
					<option value="ME">Maine</option>
					<option value="MD">Maryland</option>
					<option value="MA">Massachusetts</option>
					<option value="MI">Michigan</option>
					<option value="MN">Minnesota</option>
					<option value="MS">Mississippi</option>
					<option value="MO">Missouri</option>
					<option value="MT">Montana</option>
					<option value="NE">Nebraska</option>
					<option value="NV">Nevada</option>
					<option value="NH">New Hampshire</option>
					<option value="NJ">New Jersey</option>
					<option value="NM">New Mexico</option>
					<option value="NY">New York</option>
					<option value="NC">North Carolina</option>
					<option value="ND">North Dakota</option>
					<option value="OH">Ohio</option>
					<option value="OK">Oklahoma</option>
					<option value="OR">Oregon</option>
					<option value="PA">Pennsylvania</option>
					<option value="RI">Rhode Island</option>
					<option value="SC">South Carolina</option>
					<option value="SD">South Dakota</option>
					<option value="TN">Tennessee</option>
					<option value="TX">Texas</option>
					<option value="UT">Utah</option>
					<option value="VT">Vermont</option>
					<option value="VA">Virginia</option>
					<option value="WA">Washington</option>
					<option value="WV">West Virginia</option>
					<option value="WI">Wisconsin</option>
					<option value="WY">Wyoming</option>
				</select>
			</label>
			
			<textarea id="json_1" class="json_compare" placeholder="JSON 1"></textarea>
			<textarea id="json_2" class="json_compare" placeholder="JSON 2"></textarea>
			
			<input type="submit" id="submit" value="run" />
		</div>
		
		<div class="right">
			<label>Results:</label>
			<textarea id="results"></textarea>
			
			<label>Log:</label>
			<textarea id="log"></textarea>
			
			<label>New file:</label>
			<textarea id="file"></textarea>
		</div>
		
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> 
		
		<!-- CSV parsing https://github.com/evanplaice/jquery-csv -->
		<script type="text/javascript">
			RegExp.escape=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},function(a){"use strict";var b;b="undefined"!=typeof jQuery&&jQuery?jQuery:{},b.csv={defaults:{separator:",",delimiter:'"',headers:!0},hooks:{castToScalar:function(a){var b=/\./;if(isNaN(a))return a;if(b.test(a))return parseFloat(a);var c=parseInt(a);return isNaN(c)?null:c}},parsers:{parse:function(b,c){function d(){if(j=0,k="",c.start&&c.state.rowNum<c.start)return i=[],c.state.rowNum++,void(c.state.colNum=1);if(c.onParseEntry===a)h.push(i);else{var b=c.onParseEntry(i,c.state);b!==!1&&h.push(b)}i=[],c.end&&c.state.rowNum>=c.end&&(l=!0),c.state.rowNum++,c.state.colNum=1}function e(){if(c.onParseValue===a)i.push(k);else{var b=c.onParseValue(k,c.state);b!==!1&&i.push(b)}k="",j=0,c.state.colNum++}var f=c.separator,g=c.delimiter;c.state.rowNum||(c.state.rowNum=1),c.state.colNum||(c.state.colNum=1);var h=[],i=[],j=0,k="",l=!1,m=RegExp.escape(f),n=RegExp.escape(g),o=/(D|S|\r\n|\n|\r|[^DS\r\n]+)/,p=o.source;return p=p.replace(/S/g,m),p=p.replace(/D/g,n),o=new RegExp(p,"gm"),b.replace(o,function(a){if(!l)switch(j){case 0:if(a===f){k+="",e();break}if(a===g){j=1;break}if(/^(\r\n|\n|\r)$/.test(a)){e(),d();break}k+=a,j=3;break;case 1:if(a===g){j=2;break}k+=a,j=1;break;case 2:if(a===g){k+=a,j=1;break}if(a===f){e();break}if(/^(\r\n|\n|\r)$/.test(a)){e(),d();break}throw new Error("CSVDataError: Illegal State [Row:"+c.state.rowNum+"][Col:"+c.state.colNum+"]");case 3:if(a===f){e();break}if(/^(\r\n|\n|\r)$/.test(a)){e(),d();break}if(a===g)throw new Error("CSVDataError: Illegal Quote [Row:"+c.state.rowNum+"][Col:"+c.state.colNum+"]");throw new Error("CSVDataError: Illegal Data [Row:"+c.state.rowNum+"][Col:"+c.state.colNum+"]");default:throw new Error("CSVDataError: Unknown State [Row:"+c.state.rowNum+"][Col:"+c.state.colNum+"]")}}),0!==i.length&&(e(),d()),h},splitLines:function(b,c){function d(){if(h=0,c.start&&c.state.rowNum<c.start)return i="",void c.state.rowNum++;if(c.onParseEntry===a)g.push(i);else{var b=c.onParseEntry(i,c.state);b!==!1&&g.push(b)}i="",c.end&&c.state.rowNum>=c.end&&(j=!0),c.state.rowNum++}var e=c.separator,f=c.delimiter;c.state.rowNum||(c.state.rowNum=1);var g=[],h=0,i="",j=!1,k=RegExp.escape(e),l=RegExp.escape(f),m=/(D|S|\n|\r|[^DS\r\n]+)/,n=m.source;return n=n.replace(/S/g,k),n=n.replace(/D/g,l),m=new RegExp(n,"gm"),b.replace(m,function(a){if(!j)switch(h){case 0:if(a===e){i+=a,h=0;break}if(a===f){i+=a,h=1;break}if("\n"===a){d();break}if(/^\r$/.test(a))break;i+=a,h=3;break;case 1:if(a===f){i+=a,h=2;break}i+=a,h=1;break;case 2:var b=i.substr(i.length-1);if(a===f&&b===f){i+=a,h=1;break}if(a===e){i+=a,h=0;break}if("\n"===a){d();break}if("\r"===a)break;throw new Error("CSVDataError: Illegal state [Row:"+c.state.rowNum+"]");case 3:if(a===e){i+=a,h=0;break}if("\n"===a){d();break}if("\r"===a)break;if(a===f)throw new Error("CSVDataError: Illegal quote [Row:"+c.state.rowNum+"]");throw new Error("CSVDataError: Illegal state [Row:"+c.state.rowNum+"]");default:throw new Error("CSVDataError: Unknown state [Row:"+c.state.rowNum+"]")}}),""!==i&&d(),g},parseEntry:function(b,c){function d(){if(c.onParseValue===a)g.push(i);else{var b=c.onParseValue(i,c.state);b!==!1&&g.push(b)}i="",h=0,c.state.colNum++}var e=c.separator,f=c.delimiter;c.state.rowNum||(c.state.rowNum=1),c.state.colNum||(c.state.colNum=1);var g=[],h=0,i="";if(!c.match){var j=RegExp.escape(e),k=RegExp.escape(f),l=/(D|S|\n|\r|[^DS\r\n]+)/,m=l.source;m=m.replace(/S/g,j),m=m.replace(/D/g,k),c.match=new RegExp(m,"gm")}return b.replace(c.match,function(a){switch(h){case 0:if(a===e){i+="",d();break}if(a===f){h=1;break}if("\n"===a||"\r"===a)break;i+=a,h=3;break;case 1:if(a===f){h=2;break}i+=a,h=1;break;case 2:if(a===f){i+=a,h=1;break}if(a===e){d();break}if("\n"===a||"\r"===a)break;throw new Error("CSVDataError: Illegal State [Row:"+c.state.rowNum+"][Col:"+c.state.colNum+"]");case 3:if(a===e){d();break}if("\n"===a||"\r"===a)break;if(a===f)throw new Error("CSVDataError: Illegal Quote [Row:"+c.state.rowNum+"][Col:"+c.state.colNum+"]");throw new Error("CSVDataError: Illegal Data [Row:"+c.state.rowNum+"][Col:"+c.state.colNum+"]");default:throw new Error("CSVDataError: Unknown State [Row:"+c.state.rowNum+"][Col:"+c.state.colNum+"]")}}),d(),g}},helpers:{collectPropertyNames:function(a){var b,c,d=[];for(b in a)for(c in a[b])a[b].hasOwnProperty(c)&&d.indexOf(c)<0&&"function"!=typeof a[b][c]&&d.push(c);return d}},toArray:function(c,d,e){d=d!==a?d:{};var f={};f.callback=e!==a&&"function"==typeof e?e:!1,f.separator="separator"in d?d.separator:b.csv.defaults.separator,f.delimiter="delimiter"in d?d.delimiter:b.csv.defaults.delimiter;var g=d.state!==a?d.state:{};d={delimiter:f.delimiter,separator:f.separator,onParseEntry:d.onParseEntry,onParseValue:d.onParseValue,state:g};var h=b.csv.parsers.parseEntry(c,d);return f.callback?void f.callback("",h):h},toArrays:function(c,d,e){d=d!==a?d:{};var f={};f.callback=e!==a&&"function"==typeof e?e:!1,f.separator="separator"in d?d.separator:b.csv.defaults.separator,f.delimiter="delimiter"in d?d.delimiter:b.csv.defaults.delimiter;var g=[];return d={delimiter:f.delimiter,separator:f.separator,onPreParse:d.onPreParse,onParseEntry:d.onParseEntry,onParseValue:d.onParseValue,onPostParse:d.onPostParse,start:d.start,end:d.end,state:{rowNum:1,colNum:1}},d.onPreParse!==a&&d.onPreParse(c,d.state),g=b.csv.parsers.parse(c,d),d.onPostParse!==a&&d.onPostParse(g,d.state),f.callback?void f.callback("",g):g},toObjects:function(c,d,e){d=d!==a?d:{};var f={};f.callback=e!==a&&"function"==typeof e?e:!1,f.separator="separator"in d?d.separator:b.csv.defaults.separator,f.delimiter="delimiter"in d?d.delimiter:b.csv.defaults.delimiter,f.headers="headers"in d?d.headers:b.csv.defaults.headers,d.start="start"in d?d.start:1,f.headers&&d.start++,d.end&&f.headers&&d.end++;var g=[],h=[];d={delimiter:f.delimiter,separator:f.separator,onPreParse:d.onPreParse,onParseEntry:d.onParseEntry,onParseValue:d.onParseValue,onPostParse:d.onPostParse,start:d.start,end:d.end,state:{rowNum:1,colNum:1},match:!1,transform:d.transform};var i={delimiter:f.delimiter,separator:f.separator,start:1,end:1,state:{rowNum:1,colNum:1}};d.onPreParse!==a&&d.onPreParse(c,d.state);var j=b.csv.parsers.splitLines(c,i),k=b.csv.toArray(j[0],d);g=b.csv.parsers.splitLines(c,d),d.state.colNum=1,d.state.rowNum=k?2:1;for(var l=0,m=g.length;m>l;l++){for(var n=b.csv.toArray(g[l],d),o={},p=0;p<k.length;p++)o[k[p]]=n[p];h.push(d.transform!==a?d.transform.call(a,o):o),d.state.rowNum++}return d.onPostParse!==a&&d.onPostParse(h,d.state),f.callback?void f.callback("",h):h},fromArrays:function(c,d,e){d=d!==a?d:{};var f={};f.callback=e!==a&&"function"==typeof e?e:!1,f.separator="separator"in d?d.separator:b.csv.defaults.separator,f.delimiter="delimiter"in d?d.delimiter:b.csv.defaults.delimiter;var g,h,i,j,k="";for(i=0;i<c.length;i++){for(g=c[i],h=[],j=0;j<g.length;j++){var l=g[j]===a||null===g[j]?"":g[j].toString();l.indexOf(f.delimiter)>-1&&(l=l.replace(f.delimiter,f.delimiter+f.delimiter));var m="\n|\r|S|D";m=m.replace("S",f.separator),m=m.replace("D",f.delimiter),l.search(m)>-1&&(l=f.delimiter+l+f.delimiter),h.push(l)}k+=h.join(f.separator)+"\r\n"}return f.callback?void f.callback("",k):k},fromObjects:function(c,d,e){d=d!==a?d:{};var f={};if(f.callback=e!==a&&"function"==typeof e?e:!1,f.separator="separator"in d?d.separator:b.csv.defaults.separator,f.delimiter="delimiter"in d?d.delimiter:b.csv.defaults.delimiter,f.headers="headers"in d?d.headers:b.csv.defaults.headers,f.sortOrder="sortOrder"in d?d.sortOrder:"declare",f.manualOrder="manualOrder"in d?d.manualOrder:[],f.transform=d.transform,"string"==typeof f.manualOrder&&(f.manualOrder=b.csv.toArray(f.manualOrder,f)),f.transform!==a){var g=c;c=[];var h;for(h=0;h<g.length;h++)c.push(f.transform.call(a,g[h]))}var i=b.csv.helpers.collectPropertyNames(c);if("alpha"===f.sortOrder&&i.sort(),f.manualOrder.length>0){var j,k=[].concat(f.manualOrder);for(j=0;j<i.length;j++)k.indexOf(i[j])<0&&k.push(i[j]);i=k}var l,j,m,n,o=[];for(f.headers&&o.push(i),l=0;l<c.length;l++){for(m=[],j=0;j<i.length;j++)n=i[j],m.push(n in c[l]&&"function"!=typeof c[l][n]?c[l][n]:"");o.push(m)}return b.csv.fromArrays(o,d,f.callback)}},b.csvEntry2Array=b.csv.toArray,b.csv2Array=b.csv.toArrays,b.csv2Dictionary=b.csv.toObjects,"undefined"!=typeof module&&module.exports&&(module.exports=b.csv)}.call(this);
		</script>
		
		<script type="text/javascript">
		$(document).ready(function() {
			$('#submit').on('click', function() {
				$('#submit').val('running...').attr('disabled','disabled').addClass('disabled');
				$('textarea').not('.json_compare').val('');
				if (($('#overwrite_file').val() != '' || $('#overwrite_file_select').val() != '') && $('#google_api_key').val() != '' && $('.type:checked').val() != undefined || $('.type:checked').val() == 'json_merge') {
					if ($('#overwrite_file_select').val() != '') {
						var overwrite_file = $('#overwrite_file_select').val();
					} else {
						var overwrite_file = $('#overwrite_file').val()
					}
					
					ajax_options = {};
					
					if ($('.type:checked').val() != 'contact_method_present' && $('.type:checked').val() != 'contact_method_present_phone') {
						ajax_options.dataType = 'json';
					} else {
						ajax_options.dataType = 'text';
					}
					
					if ($('.type:checked').val() == 'json_merge') {
						console.log('start');
							
							var json_1 = JSON.parse($('#json_1').val());
							var json_2 = JSON.parse($('#json_2').val());
							var json_merged = json_2;
							
							$.each(json_1, function(json_1_iterator, json_1_object) {
								var match = false;
								$.each(json_2, function(json_2_iterator, json_2_object) {
									object = json_2_object;
									if (
										json_1_object.officials[0].overwrite_ocdid == json_2_object.officials[0].overwrite_ocdid
										&& json_1_object.officials[0].overwrite_name == json_2_object.officials[0].overwrite_name
									) {
										match = true;
									}
								});
								
								if (!match) {
									json_merged.push(json_1_object);
								}
							});
							
							console.log(json_merged);
							$('#results').val(JSON.stringify(json_merged));
							
							$('#submit').val('run').attr('disabled',false).removeClass('disabled');
					} else {
					
					$.ajax(overwrite_file, ajax_options)
					.done(function(data) {
						$('textarea').not('#file').not('.json_compare').val('start test');
						
						console.log('overwrite file loaded successfully');
						$('#log').val($('#log').val() + '\n' + 'overwrite file loaded successfully');
						
						if ($('.type:checked').val() == 'overwrite_name_match') {
							$('textarea').not('#file').not('.json_compare').val($('textarea').val() + '\n' + 'starting overwrite name match test');
						}	
						
						if ($('.type:checked').val() == 'overwrite_necessity') {
							$('textarea').not('#file').not('.json_compare').val($('textarea').val() + '\n' + 'starting overwrite necessity test');
						}	
						
						if ($('.type:checked').val() == 'bioid_necessity') {
							$('textarea').not('#file').not('.json_compare').val($('textarea').val() + '\n' + 'starting bioid necessity test');
						}
						
						if ($('.type:checked').val() == 'contact_method_present' || $('.type:checked').val() == 'contact_method_present_phone') {
							$('textarea').not('#file').not('.json_compare').val($('textarea').val() + '\n' + 'starting contact method present test');
						}
						
						if ($('.type:checked').val() == 'json_merge') {
							$('textarea').not('#file').not('.json_compare').val($('textarea').val() + '\n' + 'starting json merge');
						}
						
						if ($('.type:checked').val() == 'contact_method_present') {
							csv = $.csv.toArrays(data);
							console.log(csv);
							
							if ($('#overwrite_file_select option:selected').html() == 'headOfGovernment CSV') {
								overwrite_file = 'https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_headOfGovernment_overwrite.json';
							} else if ($('#overwrite_file_select option:selected').html() == 'ocdids_statelevel_lower CSV') {
								overwrite_file = 'https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_statelevel_lower_overwrite.json';
							} else if ($('#overwrite_file_select option:selected').html() == 'ocdids_statelevel_upper CSV') {
								overwrite_file = 'https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_statelevel_upper_overwrite.json';
							}
							
							$.getJSON(overwrite_file, function(data) {})
							.done(function(data) {
								var overwrite_data = data;
								
								$.getJSON('https://raw.githubusercontent.com/j-ro/congress-forms-data/master/bioids.json', function(data) {})
								.done(function(data) {
									var bioids = data;
									
								
									$.each(csv, function(i, e) {
										query_string = '';
		
										if (typeof(e[1]) != 'undefined' && e[1] != '') {
											query_string = query_string + '&levels=' + encodeURIComponent(e[1]);
										}
										
										if (typeof(e[2]) != 'undefined' && e[2] != '') {
											query_string = query_string + '&recursive=' + encodeURIComponent(e[2]);
										}
										
										if (typeof(e[3]) != 'undefined' && e[3] != '') {
											query_string = query_string + '&roles=' + encodeURIComponent(e[3]);
										}
										
										if (typeof(e[4]) != 'undefined' && e[4] != '') {
											query_string = query_string + '&fields=' + encodeURIComponent(e[4]);
										}
										
										if (e[0] != 'ocdid') {
											//console.log('getting ' + e[0]);
											//$('#log').val($('#log').val() + '\n' + 'getting ' + e[0]);
											
											$.getJSON('https://www.googleapis.com/civicinfo/v2/representatives/' + encodeURIComponent(e[0]) + '?key='+ $('#google_api_key').val() + query_string, function(data) {
											}).done(function(data) {
												$.each(data.officials, function(index, official) {
													var no_contact = true;
													var non_matching_bioid = false;
													//console.log(official.name);
													if (typeof(official.emails) != 'undefined' && official.emails.length > 0 && official.emails[0] != '') {
														//$('#log').val($('#log').val() + '\n' + official.name + ' has an email address: ' + official.emails[0]);
														//console.log(official.emails[0]);
														no_contact = false;
													} else if (official.name.toLowerCase() == 'vacant') {
														no_contact = false; 
													} else {
														//console.log(official.name);
														$.each(overwrite_data, function(index, overwrite_data) {
															if (typeof(overwrite_data.officials[0].emails) != 'undefined' && overwrite_data.officials[0].emails.length > 0 && overwrite_data.officials[0].emails[0] != '' && overwrite_data.officials[0].overwrite_name == official.name) {
																//$('#log').val($('#log').val() + '\n' + overwrite_data.officials[0].name + ' has an email address on the overwrite file: ' + overwrite_data.officials[0].emails[0]);
																//console.log(overwrite_data.officials[0].emails[0]);
																no_contact = false;
															} else if (overwrite_data.officials[0].name.toLowerCase() == 'vacant' && overwrite_data.officials[0].overwrite_name == official.name) {
																no_contact = false;
															} else {
																//$('#log').val($('#log').val() + '\n' + official.name + ' has NO email address on the overwrite file.');
																//console.log(official.name + ' has no email at all! Checking bioID...');
																//
															}
														});
														
														
															
														if (no_contact) {
	console.log(official.name);
															$.each(bioids, function(index, bioid) {
																if (typeof(bioid.ocd_id) != 'undefined') {
																	if (bioid.ocd_id == e[0] && bioid.name == official.name) {
																		no_contact = false;
																	} else if (bioid.ocd_id == e[0]) {
																		non_matching_bioid = true;
																	}
																}
															});
													
													
															if (no_contact) {
																//$('#log').val($('#log').val() + '\n' + official.name + ' has NO email address OR bioID!');
																//console.log(official.name + ' has no email or bioID!');
																var output_ocdid = e[0];
																
																if (output_ocdid.includes('sldl')) {
																	var output_level = 'House';
																	var output_roles = 'legislatorLowerBody';
																	var output_district_number = output_ocdid.match(/sldl:(.*)/)[1].toUpperCase();
																} else if  (output_ocdid.includes('sldu')){
																	var output_level = 'Senate';
																	var output_roles = 'legislatorUpperBody';
																	var output_district_number = output_ocdid.match(/sldu:(.*)/)[1].toUpperCase();
																}
																
																if (typeof(official.phones) != 'undefined' && official.phones.length > 0 && official.phones[0] != '') {
																	var official_phone = official.phones[0];
																} else {
																	var official_phone = "";
																}
																
																var output_state_abbreviation = output_ocdid.match(/state:(.[a-z])/)[1].toUpperCase();
																var output_state_full = $('#ignore_states option[value=' + output_ocdid.match(/state:(.[a-z])/)[1].toUpperCase() + ']').html();
																
																$('#results').val($('#results').val()
																+ '\n\n' + official.name + ' has NO email address OR bioID! \n ocdid: \n' + output_ocdid + '\n'
																+ '\n\n\ non-matching bioid is ' + non_matching_bioid + '\n'
																+ 'new override skeleton: \n'
																+ '{\n'
																+ '    "divisions": {\n'
																+ '      "' + output_ocdid + '": {\n'
																+ '        "name": "' + output_state_full + ' State ' + output_level + ' district ' + output_district_number + '",\n'
																+ '        "overwrite": "true",\n'
																+ '        "officeIndices": [\n'
																+ '          0\n'
																+ '        ]\n'
																+ '      }\n'
																+ '    },\n'
																+ '    "offices": [\n'
																+ '      {\n'
																+ '        "name": "' + output_state_abbreviation + ' State ' + output_level + ' District ' + output_district_number + '",\n'
																+ '        "divisionId": "' + output_ocdid + '",\n'
																+ '        "roles": [\n'
																+ '          "' + output_roles + '"\n'
																+ '        ],\n'
																+ '        "officialIndices": [\n'
																+ '          0\n'
																+ '        ]\n'
																+ '      }\n'
																+ '    ],\n'
																+ '    "officials": [\n'
																+ '      {\n'
																+ '        "name": "' + official.name + '",\n'
																+ '        "party": "' + official.party + '",\n'
																+ '        "overwrite_ocdid": "' + output_ocdid + '",\n'
																+ '        "overwrite_name": "' + official.name + '",\n'
																+ '        "emails": [\n'
																+ '          ""\n'
																+ '        ],\n'
																+ '        "phones": [\n'
																+ '          "' + official_phone + '"\n'
																+ '        ]\n'
																+ '      }\n'
																+ '    ]\n'
																+ '  }\n');
															} else {
																//$('#log').val($('#log').val() + '\n' + official.name + ' has a bioID.');
																//console.log(official.name + ' has a bioID');
															}
		
														}
													}
												});
											}).fail(function(jqXHR, textStatus, errorThrown) {
												console.log('google api load failed');
												$('#log').val($('#log').val() + '\n' + 'google api load failed');
												
												console.log('jqXHR: ');
												console.log(jqXHR);
												$('#log').val($('#log').val() + '\n' + 'see console for detailed error object');
												
												console.log('textStatus: ' + textStatus);
												$('#log').val($('#log').val() + '\n' + 'textStatus: ' + textStatus);
												
												console.log('errorThrown: ' + errorThrown);
												$('#log').val($('#log').val() + '\n' + 'errorThrown: ' + errorThrown);
												
												$('#submit').val('run').attr('disabled',false).removeClass('disabled');
											});
										}
									});	
								})
								.fail(function(jqXHR, textStatus, errorThrown) {
									console.log('bioIDs load failed');
									$('#log').val($('#log').val() + '\n' + 'bioIDs load failed');
									
									console.log('jqXHR: ');
									console.log(jqXHR);
									$('#log').val($('#log').val() + '\n' + 'see console for detailed error object');
									
									console.log('textStatus: ' + textStatus);
									$('#log').val($('#log').val() + '\n' + 'textStatus: ' + textStatus);
									
									console.log('errorThrown: ' + errorThrown);
									$('#log').val($('#log').val() + '\n' + 'errorThrown: ' + errorThrown);
									
									$('#submit').val('run').attr('disabled',false).removeClass('disabled');
								});
							})
							.fail(function(jqXHR, textStatus, errorThrown) {
								console.log('overwrite file load failed');
								$('#log').val($('#log').val() + '\n' + 'overwrite load failed');
								
								console.log('jqXHR: ');
								console.log(jqXHR);
								$('#log').val($('#log').val() + '\n' + 'see console for detailed error object');
								
								console.log('textStatus: ' + textStatus);
								$('#log').val($('#log').val() + '\n' + 'textStatus: ' + textStatus);
								
								console.log('errorThrown: ' + errorThrown);
								$('#log').val($('#log').val() + '\n' + 'errorThrown: ' + errorThrown);
								
								$('#submit').val('run').attr('disabled',false).removeClass('disabled');
							});
							
							
							
							if ($.active >= 1) {
								setTimeout(function() {
									$('#submit').val('run').attr('disabled',false).removeClass('disabled');
								}, 5000);
							}
						} else if ($('.type:checked').val() == 'contact_method_present_phone') {
							csv = $.csv.toArrays(data);
							console.log(csv);
							
							if ($('#overwrite_file_select option:selected').html() == 'headOfGovernment CSV') {
								overwrite_file = 'https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_headOfGovernment_overwrite.json';
							} else if ($('#overwrite_file_select option:selected').html() == 'ocdids_statelevel_lower CSV') {
								overwrite_file = 'https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_statelevel_lower_overwrite.json';
							} else if ($('#overwrite_file_select option:selected').html() == 'ocdids_statelevel_upper CSV') {
								overwrite_file = 'https://raw.githubusercontent.com/j-ro/congress-forms-data/master/ocdid_statelevel_upper_overwrite.json';
							}
							
							$.getJSON(overwrite_file, function(data) {})
							.done(function(data) {
								var overwrite_data = data;
								
								$.getJSON('https://raw.githubusercontent.com/j-ro/congress-forms-data/master/bioids.json', function(data) {})
								.done(function(data) {
									var bioids = data;
									
								
									$.each(csv, function(i, e) {
										query_string = '';
		
										if (typeof(e[1]) != 'undefined' && e[1] != '') {
											query_string = query_string + '&levels=' + encodeURIComponent(e[1]);
										}
										
										if (typeof(e[2]) != 'undefined' && e[2] != '') {
											query_string = query_string + '&recursive=' + encodeURIComponent(e[2]);
										}
										
										if (typeof(e[3]) != 'undefined' && e[3] != '') {
											query_string = query_string + '&roles=' + encodeURIComponent(e[3]);
										}
										
										if (typeof(e[4]) != 'undefined' && e[4] != '') {
											query_string = query_string + '&fields=' + encodeURIComponent(e[4]);
										}
										
										if (e[0] != 'ocdid') {
											//console.log('getting ' + e[0]);
											//$('#log').val($('#log').val() + '\n' + 'getting ' + e[0]);
											
											$.getJSON('https://www.googleapis.com/civicinfo/v2/representatives/' + encodeURIComponent(e[0]) + '?key='+ $('#google_api_key').val() + query_string, function(data) {
											}).done(function(data) {
												$.each(data.officials, function(index, official) {
													var no_contact = true;
													var non_matching_bioid = false;
													//console.log(official.name);
													if (typeof(official.phones) != 'undefined' && official.phones.length > 0 && official.phones[0] != '') {
														//$('#log').val($('#log').val() + '\n' + official.name + ' has an email address: ' + official.emails[0]);
														//console.log(official.emails[0]);
														no_contact = false;
													} else if (official.name.toLowerCase() == 'vacant') {
														no_contact = false; 
													} else {
														//console.log(official.name);
														$.each(overwrite_data, function(index, overwrite_data) {
															if (typeof(overwrite_data.officials[0].phones) != 'undefined' && overwrite_data.officials[0].phones.length > 0 && overwrite_data.officials[0].phones[0] != '' && overwrite_data.officials[0].overwrite_name == official.name) {
																//$('#log').val($('#log').val() + '\n' + overwrite_data.officials[0].name + ' has an email address on the overwrite file: ' + overwrite_data.officials[0].emails[0]);
																//console.log(overwrite_data.officials[0].emails[0]);
																no_contact = false;
															} else if (overwrite_data.officials[0].name.toLowerCase() == 'vacant' && overwrite_data.officials[0].overwrite_name == official.name) {
																no_contact = false;
															} else {
																//$('#log').val($('#log').val() + '\n' + official.name + ' has NO email address on the overwrite file.');
																//console.log(official.name + ' has no email at all! Checking bioID...');
																//
															}
														});
														
														
															
														if (no_contact) {
	console.log(official.name);
															$.each(bioids, function(index, bioid) {
																if (typeof(bioid.ocd_id) != 'undefined') {
																	if (bioid.ocd_id == e[0] && bioid.name == official.name) {
																		//no_contact = false;
																	} else if (bioid.ocd_id == e[0]) {
																		non_matching_bioid = true;
																	}
																}
															});
													
													
															if (no_contact) {
																//$('#log').val($('#log').val() + '\n' + official.name + ' has NO email address OR bioID!');
																//console.log(official.name + ' has no email or bioID!');
																var output_ocdid = e[0];
																
																if (output_ocdid.includes('sldl')) {
																	var output_level = 'House';
																	var output_roles = 'legislatorLowerBody';
																	var output_district_number = output_ocdid.match(/sldl:(.*)/)[1].toUpperCase();
																} else if  (output_ocdid.includes('sldu')){
																	var output_level = 'Senate';
																	var output_roles = 'legislatorUpperBody';
																	var output_district_number = output_ocdid.match(/sldu:(.*)/)[1].toUpperCase();
																}
																
																if (typeof(official.emails) != 'undefined' && official.emails.length > 0 && official.emails[0] != '') {
																	var official_email = official.emails[0];
																} else {
																	var official_email = "";
																}
																console.log(output_ocdid);
																
																var output_state_abbreviation = output_ocdid.match(/state:(.[a-z])/)[1].toUpperCase();
																var output_state_full = $('#ignore_states option[value=' + output_ocdid.match(/state:(.[a-z])/)[1].toUpperCase() + ']').html();
																
																$('#results').val($('#results').val()
																+ '\n\n' + official.name + ' has NO phone! \n ocdid: \n' + output_ocdid + '\n'
																+ '\n\n\ non-matching bioid is ' + non_matching_bioid + '\n'
																+ 'new override skeleton: \n'
																+ '{\n'
																+ '    "divisions": {\n'
																+ '      "' + output_ocdid + '": {\n'
																+ '        "name": "' + output_state_full + ' State ' + output_level + ' district ' + output_district_number + '",\n'
																+ '        "overwrite": "true",\n'
																+ '        "officeIndices": [\n'
																+ '          0\n'
																+ '        ]\n'
																+ '      }\n'
																+ '    },\n'
																+ '    "offices": [\n'
																+ '      {\n'
																+ '        "name": "' + output_state_abbreviation + ' State ' + output_level + ' District ' + output_district_number + '",\n'
																+ '        "divisionId": "' + output_ocdid + '",\n'
																+ '        "roles": [\n'
																+ '          "' + output_roles + '"\n'
																+ '        ],\n'
																+ '        "officialIndices": [\n'
																+ '          0\n'
																+ '        ]\n'
																+ '      }\n'
																+ '    ],\n'
																+ '    "officials": [\n'
																+ '      {\n'
																+ '        "name": "' + official.name + '",\n'
																+ '        "party": "' + official.party + '",\n'
																+ '        "overwrite_ocdid": "' + output_ocdid + '",\n'
																+ '        "overwrite_name": "' + official.name + '",\n'
																+ '        "emails": [\n'
																+ '          "' + official_email + '"\n'
																+ '        ],\n'
																+ '        "phones": [\n'
																+ '          ""\n'
																+ '        ]\n'
																+ '      }\n'
																+ '    ]\n'
																+ '  }\n');
															} else {
																//$('#log').val($('#log').val() + '\n' + official.name + ' has a bioID.');
																//console.log(official.name + ' has a bioID');
															}
		
														}
													}
												});
											}).fail(function(jqXHR, textStatus, errorThrown) {
												console.log('google api load failed');
												$('#log').val($('#log').val() + '\n' + 'google api load failed');
												
												console.log('jqXHR: ');
												console.log(jqXHR);
												$('#log').val($('#log').val() + '\n' + 'see console for detailed error object');
												
												console.log('textStatus: ' + textStatus);
												$('#log').val($('#log').val() + '\n' + 'textStatus: ' + textStatus);
												
												console.log('errorThrown: ' + errorThrown);
												$('#log').val($('#log').val() + '\n' + 'errorThrown: ' + errorThrown);
												
												$('#submit').val('run').attr('disabled',false).removeClass('disabled');
											});
										}
									});	
								})
								.fail(function(jqXHR, textStatus, errorThrown) {
									console.log('bioIDs load failed');
									$('#log').val($('#log').val() + '\n' + 'bioIDs load failed');
									
									console.log('jqXHR: ');
									console.log(jqXHR);
									$('#log').val($('#log').val() + '\n' + 'see console for detailed error object');
									
									console.log('textStatus: ' + textStatus);
									$('#log').val($('#log').val() + '\n' + 'textStatus: ' + textStatus);
									
									console.log('errorThrown: ' + errorThrown);
									$('#log').val($('#log').val() + '\n' + 'errorThrown: ' + errorThrown);
									
									$('#submit').val('run').attr('disabled',false).removeClass('disabled');
								});
							})
							.fail(function(jqXHR, textStatus, errorThrown) {
								console.log('overwrite file load failed');
								$('#log').val($('#log').val() + '\n' + 'overwrite load failed');
								
								console.log('jqXHR: ');
								console.log(jqXHR);
								$('#log').val($('#log').val() + '\n' + 'see console for detailed error object');
								
								console.log('textStatus: ' + textStatus);
								$('#log').val($('#log').val() + '\n' + 'textStatus: ' + textStatus);
								
								console.log('errorThrown: ' + errorThrown);
								$('#log').val($('#log').val() + '\n' + 'errorThrown: ' + errorThrown);
								
								$('#submit').val('run').attr('disabled',false).removeClass('disabled');
							});
							
							
							
							if ($.active >= 1) {
								setTimeout(function() {
									$('#submit').val('run').attr('disabled',false).removeClass('disabled');
								}, 5000);
							}
						} else if ($('.type:checked').val() == 'bioid_necessity') {
							$.each(data, function(index, value) {
								if (value.ocd_id) {
									
									file = data;
									
									var ocdid = value.ocd_id;
									var name = value.name;
									
									console.log('getting ' + ocdid);
									$('#log').val($('#log').val() + '\n' + 'getting ' + ocdid);
									
									
									$.getJSON('https://www.googleapis.com/civicinfo/v2/representatives/' + encodeURIComponent(ocdid) + '?key='+ $('#google_api_key').val(), function(data) {
										
										var match = false;
										var emails_present = false;
										
										if (data.officials && data.officials.length) {
											$.each(data.officials, function(index1, value1) {
												//console.log(value.name + ' == ' + overwrite_name);
												$('#log').val($('#log').val() + '\n' + value1.name + ' == ' + name);
												if (value1.name == name) {
													match = true;
													
													if (typeof(value1.emails !== 'undefined') && Array.isArray(value1.emails) && value1.emails.length > 0) {				
														emails_present = true;
													
													}
												}
											});
											
											//console.log(match);
											$('#log').val($('#log').val() + '\n' + 'match? ' + match);
										} else {
											//console.log('no officials found for ' + ocdid);
											$('#log').val($('#log').val() + '\n' + 'no officials found for ' + ocdid);
										}
										
										if ((match == true && emails_present == true) || match == false) {
											var log_results = true;
											
											if ($('#ignore_states option:selected').length) {
												$('#ignore_states option:selected').each(function() {
													if (ocdid.indexOf('state:' + $(this).val().toLowerCase()) != -1) {
														log_results = false;
													}
												});
											}
											
											if (log_results) {
												$('#results').val($('#results').val() + '\n\n' + name + ' is not necessary! \n non-necessary ocdid: \n' + ocdid);
												
												if (value.ocd_id == ocdid) {
													delete file[index];
												}
											}
										}
										
									}).fail(function(jqXHR, textStatus, errorThrown) {
										console.log('google api load failed');
										$('#log').val($('#log').val() + '\n' + 'google api load failed');
										
										console.log('jqXHR: ');
										console.log(jqXHR);
										$('#log').val($('#log').val() + '\n' + 'see console for detailed error object');
										
										console.log('textStatus: ' + textStatus);
										$('#log').val($('#log').val() + '\n' + 'textStatus: ' + textStatus);
										
										console.log('errorThrown: ' + errorThrown);
										$('#log').val($('#log').val() + '\n' + 'errorThrown: ' + errorThrown);
										
										$('#submit').val('run').attr('disabled',false).removeClass('disabled');
									});
									
									if ($.active >= 1) {
										setTimeout(function() {
											$('#submit').val('run').attr('disabled',false).removeClass('disabled');
										}, 5000);
										
										if ($('.type:checked').val() == 'bioid_necessity') {
											//$('#file').val(JSON.stringify(file));
										}
									}
									
								}
								
							});
						} else {
							$.each(data, function(index, value) {
								var ocdid = value.officials[0].overwrite_ocdid;
								var overwrite_name = value.officials[0].overwrite_name;
								var name = value.officials[0].name;
								
								if (typeof(value.officials[0].party !== 'undefined')) {
									var overwrite_party = value.officials[0].party;
								}
								
								console.log(value.officials[0].emails);
								if (typeof(value.officials[0].emails !== 'undefined') && Array.isArray(value.officials[0].emails) && value.officials[0].emails.length > 0) {
									var overwrite_email = value.officials[0].emails[0];
								}
								
								if (typeof(value.officials[0].phones !== 'undefined') && Array.isArray(value.officials[0].phones) && value.officials[0].phones.length > 0) {
									var overwrite_phone = value.officials[0].phones[0];
								}
								
								
								
								console.log('getting ' + ocdid);
								$('#log').val($('#log').val() + '\n' + 'getting ' + ocdid);
								
								
								$.getJSON('https://www.googleapis.com/civicinfo/v2/representatives/' + encodeURIComponent(ocdid) + '?key='+ $('#google_api_key').val(), function(data) {
								
									//overwrite name match test
									if ($('.type:checked').val() == 'overwrite_name_match') {
										var match = false;
										
										if (data.officials && data.officials.length) {
											$.each(data.officials, function(index1, value1) {
												//console.log(value.name + ' == ' + overwrite_name);
												$('#log').val($('#log').val() + '\n' + value1.name + ' == ' + overwrite_name);
												if (value1.name == overwrite_name) {
													match = true;
												}
											});
											
											//console.log(match);
											$('#log').val($('#log').val() + '\n' + 'match? ' + match);
										} else {
											//console.log('no officials found for ' + ocdid);
											$('#log').val($('#log').val() + '\n' + 'no officials found for ' + ocdid);
										}
										
										if (match == false) {
											//console.log(overwrite_name + ' does not match! \n non-matching ocdid: ' + ocdid);
											var log_results = true;
											if ($('#ignore_states option:selected').length) {
												$('#ignore_states option:selected').each(function() {
													if (ocdid.indexOf('state:' + $(this).val().toLowerCase()) != -1) {
														log_results = false;
													}
												});
											}
											
											if (log_results) {
												$('#results').val($('#results').val() + '\n\n' + overwrite_name + ' does not match! \n non-matching ocdid: \n' + ocdid);
											}
										}
									}
	
									//overwrite necessity test
									if ($('.type:checked').val() == 'overwrite_necessity') {
										var match = false;
										var match_party = false;
										var match_email = false;
										var match_phone = false;
										var overwrite_object = {};
										
										if (data.officials && data.officials.length) {
											$.each(data.officials, function(index1, value1) {
												//console.log(value.name + ' == ' + overwrite_name);
												$('#log').val($('#log').val() + '\n' + value1.name + ' == ' + overwrite_name);
												if (value1.name == overwrite_name && overwrite_name == name) {
													match = true;
													overwrite_object = value1;
													
													if (overwrite_party && value1.party && value1.party.toLowerCase() != overwrite_party.toLowerCase()) {
														match_party = true;
													}
													
													if (typeof(value1.emails !== 'undefined') && Array.isArray(value1.emails) && value1.emails.length > 0) {				
														$.each(value1.emails, function(index2, value2) {
															if (overwrite_email && value2 && value2.toLowerCase() != overwrite_email.toLowerCase()) {
																match_email = true;
															}
														});
													
													}
													
													if (typeof(value1.phones !== 'undefined') && Array.isArray(value1.phones) && value1.phones.length > 0) {
														$.each(value1.phones, function(index2, value2) {
															if (overwrite_phone && value2 != overwrite_phone) {
																match_phone = true;
															}
														});
													}
												}
											});
											
											//console.log(match);
											$('#log').val($('#log').val() + '\n' + 'match? ' + match);
										} else {
											//console.log('no officials found for ' + ocdid);
											$('#log').val($('#log').val() + '\n' + 'no officials found for ' + ocdid);
										}
										
										if (match == true) {
											var log_results = true;
											
											if (overwrite_object.phones != undefined && overwrite_object.emails != undefined && overwrite_object.phones.length > 0 && overwrite_object.emails.length > 0) {
												if ($('#ignore_states option:selected').length) {
													$('#ignore_states option:selected').each(function() {
														if (ocdid.indexOf('state:' + $(this).val().toLowerCase()) != -1) {
															log_results = false;
														}
													});
												}
												
												if (log_results) {
													$('#results').val($('#results').val() + '\n\n' + overwrite_name + ' is not necessary! \n non-necessary ocdid: \n' + ocdid);
													
													if (match_party) {
														$('#results').val($('#results').val() + '\nParty does not match.');
													}
													
													if (match_email) {
														$('#results').val($('#results').val() + '\nEmail does not match.');
													}
													
													if (match_phone) {
														$('#results').val($('#results').val() + '\nPhone does not match.');
													}
												}
											}
										}
									}
	
									
									if ($.active >= 1) {
										setTimeout(function() {
											$('#submit').val('run').attr('disabled',false).removeClass('disabled');
										}, 5000);
									}
									
								}).fail(function(jqXHR, textStatus, errorThrown) {
									console.log('google api load failed');
									$('#log').val($('#log').val() + '\n' + 'google api load failed');
									
									console.log('jqXHR: ');
									console.log(jqXHR);
									$('#log').val($('#log').val() + '\n' + 'see console for detailed error object');
									
									console.log('textStatus: ' + textStatus);
									$('#log').val($('#log').val() + '\n' + 'textStatus: ' + textStatus);
									
									console.log('errorThrown: ' + errorThrown);
									$('#log').val($('#log').val() + '\n' + 'errorThrown: ' + errorThrown);
									
									$('#submit').val('run').attr('disabled',false).removeClass('disabled');
								});
							});
						}
							
					}).fail(function(jqXHR, textStatus, errorThrown) {
						console.log('overwrite file load failed');
						$('#log').val($('#log').val() + '\n' + 'overwrite file load failed');
						
						console.log('jqXHR: ');
						console.log(jqXHR);
						$('#log').val($('#log').val() + '\n' + 'see console for detailed error object');
						
						console.log('textStatus: ' + textStatus);
						$('#log').val($('#log').val() + '\n' + 'textStatus: ' + textStatus);
						
						console.log('errorThrown: ' + errorThrown);
						$('#log').val($('#log').val() + '\n' + 'errorThrown: ' + errorThrown);
						
						$('#submit').val('run').attr('disabled',false).removeClass('disabled');
					});
					
				 } } else {
					console.log('please fill in all required fields');
					$('textarea').not('.json_compare').val('please fill in all required fields');
					
					$('#submit').val('run').attr('disabled',false).removeClass('disabled');
				}
				
			});
		});
		</script>
	</body>
</html>